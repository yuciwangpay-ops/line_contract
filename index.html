<body>
    <h2>ğŸ“ ç™¼èµ·æ–°ç¿’æ…£å¥‘ç´„</h2>
    
    <div id="createForm">
        <label>ç¿’æ…£åç¨± (ä¾‹å¦‚: æ—©èµ·é‹å‹•)</label><br>
        <input type="text" id="habitName" placeholder="è¼¸å…¥åç¨±"><br><br>
        
        <label>ç¿’æ…£æè¿° (ä¾‹å¦‚: æ™¨è·‘3å…¬é‡Œ)</label><br>
        <input type="text" id="description" placeholder="è¼¸å…¥æè¿°"><br><br>
        
        <label>æ‡²ç½°æ¢æ¬¾ (ä¾‹å¦‚: è«‹å–å’–å•¡)</label><br>
        <input type="text" id="penalty" placeholder="è¼¸å…¥æ‡²ç½°"><br><br>
        
        <label>ç‚ºæœŸå¹¾å¤© (ä¾‹å¦‚: 21)</label><br>
        <input type="number" id="duration" placeholder="21"><br><br>
        
        <button onclick="submitContract()">å»ºç«‹å¥‘ç´„ä¸¦é‚€è«‹æœ‹å‹</button>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        // åˆå§‹åŒ– LIFF
        async function main() {
            await liff.init({ liffId: "ä½ çš„LIFF_ID" });
            if (!liff.isLoggedIn()) {
                liff.login();
            }
        }
        main();

        // é€å‡ºè³‡æ–™çµ¦ GAS
        async function submitContract() {
            const profile = await liff.getProfile();
            const habitName = document.getElementById("habitName").value;
            const description = document.getElementById("description").value;
            const penalty = document.getElementById("penalty").value;
            const duration = document.getElementById("duration").value;

            // æª¢æŸ¥å¿…å¡«
            if(!habitName || !duration) {
                alert("è«‹å¡«å¯«ç¿’æ…£åç¨±å’Œå¤©æ•¸ï¼");
                return;
            }

            // é¡¯ç¤ºå‚³é€ä¸­...
            alert("æ­£åœ¨å»ºç«‹å¥‘ç´„...");

            // å‘¼å« GAS (è¨˜å¾—æ›æˆä½ çš„æ–° GAS ç¶²å€)
            const response = await fetch("ä½ çš„GASç¶²å€/exec", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    action: "create_contract", // å‘Šè¨´ GAS æˆ‘è¦å»ºç«‹å¥‘ç´„
                    userId: profile.userId,
                    userName: profile.displayName,
                    habitName: habitName,
                    description: description,
                    penalty: penalty,
                    duration: duration
                })
            });
            
            const data = await response.json();
            
            if (data.result === "success") {
                alert("å»ºç«‹æˆåŠŸï¼å¥‘ç´„ä»£ç¢¼æ˜¯ï¼š" + data.contractId);
                // é€™è£¡ä¹‹å¾Œæˆ‘å€‘æœƒåšã€Œåˆ†äº«çµ¦å¥½å‹ã€çš„åŠŸèƒ½
            } else {
                alert("å»ºç«‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦");
            }
        }
    </script>
</body>
